<nav class="navbar">
    <a href="/homepage" class="text-wrapper">
        <div class="brand">Le Petit Livreur</div>
    </a>

    <div class="search-wrapper">
        <input type="text" placeholder="Rechercher un produit..." class="search-input" (focus)="onSearchFocus()"
            (blur)="onSearchBlur()" (input)="onSearchChange($event)" />
    </div>

    <div class="cart-icon" (click)="toggleCart()">
        <svg width="28" height="28" fill="#03dac6" viewBox="0 0 24 24">
            <path
                d="M7 18c-1.104 0-2 .896-2 2s.896 2 2 2 2-.896 2-2-.896-2-2-2zm10 0c-1.104 0-2 .896-2 2s.896 2 2 2 2-.896 2-2-.896-2-2-2zm1.83-3.41l1.72-7.45A1 1 0 0 0 19.56 6H6.21l-.94-2H2v2h2l3.6 7.59-1.35 2.44A1.992 1.992 0 0 0 6 17c0 1.1.9 2 2 2h12v-2H8.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.74-1.03z" />
        </svg>
        <span *ngIf="getCartItemCount() > 0" class="cart-badge">{{ getCartItemCount() > 9 ? '9+' : getCartItemCount()
            }}</span>


        <div class="cart-dropdown" *ngIf="cartOpen">
            <div *ngIf="cartItems.length === 0" class="empty-cart">Votre panier est vide.</div>
            <div class="cart-item" *ngFor="let item of cartItems">
                <span class="cart-name" title="{{ item.name }}" [routerLink]="['/product', item.productId]"
                    style="cursor:pointer;">
                    {{ item.name }}
                </span>
                <div class="cart-controls">
                    <button class="qty-btn" (click)="updateQuantity(item, item.quantity - 1); $event.stopPropagation()"
                        [disabled]="item.quantity <= 1">-</button>
                    <span class="qty">{{ item.quantity }}</span>
                    <button class="qty-btn"
                        (click)="updateQuantity(item, item.quantity + 1); $event.stopPropagation()">+</button>
                </div>
                <span class="cart-price">{{ item.price * item.quantity }} €</span>
                <button class="remove-btn" (click)="removeFromCart(item); $event.stopPropagation()">
                    <svg width="18" height="18" fill="#ff4b4b" viewBox="0 0 448 512">
                        <path
                            d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z" />
                    </svg>
                </button>
            </div>
            <div class="cart-total">
                Total : <strong>{{ getCartTotal() }} €</strong>
            </div>
            <button *ngIf="cartItems.length > 0" class="go-cart-btn" (click)="goToCart()">Voir le panier</button>
        </div>
    </div>

    <div class="notification-icon" (click)="toggleNotifications()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#03dac6" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        <span *ngIf="unreadNotificationsCount > 0" class="notification-badge">
            {{ unreadNotificationsCount > 9 ? '9+' : unreadNotificationsCount }}
        </span>
    </div>

    <div class="account" (click)="toggleMenu()">
        <svg width="28" height="28" fill="#03dac6" viewBox="0 0 512 512" class="user-icon">
            <path
                d="M399 384.2C376.9 345.8 335.4 320 288 320l-64 0c-47.4 0-88.9 25.8-111 64.2c35.2 39.2 86.2 63.8 143 63.8s107.8-24.7 143-63.8zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm256 16a72 72 0 1 0 0-144 72 72 0 1 0 0 144z" />
        </svg>

        <div class="dropdown" [class.show]="menuOpen">
            <p>{{ user?.name }}</p>
            <small>{{ user?.role === 'seller' ? 'Vendeur' : 'Client' }}</small>
            <button class="settings-btn" (click)="settings()">Paramètres</button>
            <button class="settings-btn" *ngIf="user?.role === 'seller'" (click)="goToMyStore()">Mes boutiques</button>
            <button class="settings-btn" (click)="myOrders()">Mes commandes</button>
            <button class="settings-btn" (click)="goToWishlist()">Ma wishlist</button>
            <button class="logout-btn" (click)="logout()">Deconnexion</button>
        </div>
    </div>
</nav>